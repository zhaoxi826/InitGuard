2026-02-15 11:41:31.111 | INFO     | resource.task.backup_task:run:44 - --- 任务 2 开始执行 ---
2026-02-15 11:41:31.111 | INFO     | resource.task.backup_task:work:20 - 开始备份...
2026-02-15 11:41:31.113 | ERROR    | resource.task.backup_task:work:34 - 备份失败: 数据库备份进程异常退出，状态码: 1, 原因: Error dump
2026-02-15 11:41:31.113 | ERROR    | resource.task.backup_task:run:53 - 任务执行崩溃
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.12/bin/pytest", line 7, in <module>
    sys.exit(console_main())
    │   │    └ <function console_main at 0x7f79016fdda0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/config/__init__.py", line 223, in console_main
    code = main()
           └ <function main at 0x7f79016fdd00>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/config/__init__.py", line 199, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7f7901657a40>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f790154e750>
         │                └ <_pytest.config.Config object at 0x7f7901657a40>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7f7901657a40>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7f7901657a40>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7f7901fd04a0>
           └ <_pytest.config.PytestPluginManager object at 0x7f79020ea030>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7f7901657a40>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/main.py", line 365, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7f79017cc2c0>
           │            └ <_pytest.config.Config object at 0x7f7901657a40>
           └ <function wrap_session at 0x7f79017cc180>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/main.py", line 318, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=2>
    │       │            │    └ <_pytest.config.Config object at 0x7f7901657a40>
    │       │            └ <function _main at 0x7f79017cc2c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=2>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/main.py", line 372, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=2>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7f790154e750>
    └ <_pytest.config.Config object at 0x7f7901657a40>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=2>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=2>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7f7901fd04a0>
           └ <_pytest.config.PytestPluginManager object at 0x7f79020ea030>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=2>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/main.py", line 396, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ None
    │    │                                        └ <Coroutine test_backup_task_failure>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_backup_task_failure>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_backup_task_failure>, 'nextitem': None}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_backup_task_failure>, 'nextitem': None}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7f7901fd04a0>
           └ <_pytest.config.PytestPluginManager object at 0x7f79020ea030>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_backup_task_failure>, None]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 118, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ None
    │               └ <Coroutine test_backup_task_failure>
    └ <function runtestprotocol at 0x7f79017bf380>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 137, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_backup_task_failure>
    │       │      └ <function call_and_report at 0x7f79017bf7e0>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/test_backup_task.py::test_backup_task_failure' when='setup' outcome='passed'>]
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 244, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7f79017bfba0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 353, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7f78fdd07880>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 245, in <lambda>
    lambda: runtest_hook(item=item, **kwds),
            │                 │       └ {}
            │                 └ <Coroutine test_backup_task_failure>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_backup_task_failure>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_backup_task_failure>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.12/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7f7901fd04a0>
           └ <_pytest.config.PytestPluginManager object at 0x7f79020ea030>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_backup_task_failure>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 179, in pytest_runtest_call
    item.runtest()
    │    └ <function PytestAsyncioFunction.runtest at 0x7f7900bb93a0>
    └ <Coroutine test_backup_task_failure>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 469, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/python.py", line 1720, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_backup_task_failure>
    │    └ <property object at 0x7f7901717b50>
    └ <Coroutine test_backup_task_failure>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_backup_task_failure>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_backup_task_failure>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7f7901fd04a0>
           └ <_pytest.config.PytestPluginManager object at 0x7f79020ea030>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_backup_task_failure>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/python.py", line 166, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {}
             └ <function test_backup_task_failure at 0x7f78fdd07600>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 716, in inner
    runner.run(coro, context=context)
    │      │   │             └ <_contextvars.Context object at 0x7f78fdced340>
    │      │   └ <coroutine object test_backup_task_failure at 0x7f78fdd4fe20>
    │      └ <function Runner.run at 0x7f7901333c40>
    └ <asyncio.runners.Runner object at 0x7f78fdcfd190>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-6' coro=<test_backup_task_failure() running at /app/tests/test_backup_task.py:73> cb=[_run_until_com...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7f7901331800>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7f78fdcfd190>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7f7901331760>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7f7901333560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7f79012c7b00>
    └ <Handle Task.task_wakeup(<_GatheringFu...=[None, None]>)>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<_GatheringFu...=[None, None]>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<_GatheringFu...=[None, None]>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<_GatheringFu...=[None, None]>)>

  File "/app/tests/test_backup_task.py", line 73, in test_backup_task_failure
    await process.run()
          │       └ <function BackupTaskProcess.run at 0x7f78fe1f34c0>
          └ <resource.task.backup_task.BackupTaskProcess object at 0x7f78fdb66780>

> File "/app/resource/task/backup_task.py", line 49, in run
    await self.work(task_logger)
          │    │    └ <loguru.logger handlers=[(id=0, level=10, sink=<_io.FileIO name=8 mode='rb+' closefd=True>), (id=2, level=10, sink='data/logs...
          │    └ <function BackupTaskProcess.work at 0x7f78fe1f32e0>
          └ <resource.task.backup_task.BackupTaskProcess object at 0x7f78fdb66780>

  File "/app/resource/task/backup_task.py", line 35, in work
    raise e

  File "/app/resource/task/backup_task.py", line 30, in work
    raise Exception(f"数据库备份进程异常退出，状态码: {db_process.returncode}, 原因: {err_info}")
                                        │          │                 └ 'Error dump'
                                        │          └ 1
                                        └ <AsyncMock id='140157629264672'>

Exception: 数据库备份进程异常退出，状态码: 1, 原因: Error dump
2026-02-15 11:41:31.127 | INFO     | resource.task.backup_task:run:56 - --- 任务 2 结束 ---
2026-02-15 11:49:24.834 | INFO     | resource.task.backup_task:run:44 - --- 任务 2 开始执行 ---
2026-02-15 11:49:24.835 | INFO     | resource.task.backup_task:work:20 - 开始备份...
2026-02-15 11:49:24.835 | ERROR    | resource.task.backup_task:work:34 - 备份失败: 数据库备份进程异常退出，状态码: 1, 原因: Error dump
2026-02-15 11:49:24.835 | ERROR    | resource.task.backup_task:run:53 - 任务执行崩溃
Traceback (most recent call last):

  File "/home/jules/.pyenv/versions/3.12.12/bin/pytest", line 7, in <module>
    sys.exit(console_main())
    │   │    └ <function console_main at 0x7fd16ca6dda0>
    │   └ <built-in function exit>
    └ <module 'sys' (built-in)>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/config/__init__.py", line 223, in console_main
    code = main()
           └ <function main at 0x7fd16ca6dd00>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/config/__init__.py", line 199, in main
    ret: ExitCode | int = config.hook.pytest_cmdline_main(config=config)
         │                │      │    │                          └ <_pytest.config.Config object at 0x7fd16d1a6570>
         │                │      │    └ <HookCaller 'pytest_cmdline_main'>
         │                │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fd16c5af680>
         │                └ <_pytest.config.Config object at 0x7fd16d1a6570>
         └ <enum 'ExitCode'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'config': <_pytest.config.Config object at 0x7fd16d1a6570>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_cmdline_main'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_cmdline_main'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_cmdline_main'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'config': <_pytest.config.Config object at 0x7fd16d1a6570>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-pa...
           │    │               └ 'pytest_cmdline_main'
           │    └ <function _multicall at 0x7fd16d0304a0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd16c704050>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<_pytest.config.Config object at 0x7fd16d1a6570>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/main.py", line 365, in pytest_cmdline_main
    return wrap_session(config, _main)
           │            │       └ <function _main at 0x7fd16c82c2c0>
           │            └ <_pytest.config.Config object at 0x7fd16d1a6570>
           └ <function wrap_session at 0x7fd16c82c180>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/main.py", line 318, in wrap_session
    session.exitstatus = doit(config, session) or 0
    │       │            │    │       └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=3>
    │       │            │    └ <_pytest.config.Config object at 0x7fd16d1a6570>
    │       │            └ <function _main at 0x7fd16c82c2c0>
    │       └ <ExitCode.OK: 0>
    └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=3>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/main.py", line 372, in _main
    config.hook.pytest_runtestloop(session=session)
    │      │    │                          └ <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=3>
    │      │    └ <HookCaller 'pytest_runtestloop'>
    │      └ <_pytest.config.compat.PathAwareHookProxy object at 0x7fd16c5af680>
    └ <_pytest.config.Config object at 0x7fd16d1a6570>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=3>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtestloop'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtestloop'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtestloop'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'session': <Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=3>}
           │    │               │          └ [<HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-pa...
           │    │               └ 'pytest_runtestloop'
           │    └ <function _multicall at 0x7fd16d0304a0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd16c704050>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Session  exitstatus=<ExitCode.OK: 0> testsfailed=0 testscollected=3>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='main', plugin=<module '_pytest.main' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-pac...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/main.py", line 396, in pytest_runtestloop
    item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)
    │    │                                        │              └ None
    │    │                                        └ <Coroutine test_backup_task_failure>
    │    └ <member 'config' of 'Node' objects>
    └ <Coroutine test_backup_task_failure>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'item': <Coroutine test_backup_task_failure>, 'nextitem': None}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_protocol'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_protocol'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_protocol'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'item': <Coroutine test_backup_task_failure>, 'nextitem': None}
           │    │               │          └ [<HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/sit...
           │    │               └ 'pytest_runtest_protocol'
           │    └ <function _multicall at 0x7fd16d0304a0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd16c704050>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_backup_task_failure>, None]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 118, in pytest_runtest_protocol
    runtestprotocol(item, nextitem=nextitem)
    │               │              └ None
    │               └ <Coroutine test_backup_task_failure>
    └ <function runtestprotocol at 0x7fd16c81f380>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 137, in runtestprotocol
    reports.append(call_and_report(item, "call", log))
    │       │      │               │             └ True
    │       │      │               └ <Coroutine test_backup_task_failure>
    │       │      └ <function call_and_report at 0x7fd16c81f7e0>
    │       └ <method 'append' of 'list' objects>
    └ [<TestReport 'tests/test_backup_task.py::test_backup_task_failure' when='setup' outcome='passed'>]
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 244, in call_and_report
    call = CallInfo.from_call(
           │        └ <classmethod(<function CallInfo.from_call at 0x7fd16c81fba0>)>
           └ <class '_pytest.runner.CallInfo'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 353, in from_call
    result: TResult | None = func()
            │                └ <function call_and_report.<locals>.<lambda> at 0x7fd168d63ec0>
            └ +TResult
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 245, in <lambda>
    lambda: runtest_hook(item=item, **kwds),
            │                 │       └ {}
            │                 └ <Coroutine test_backup_task_failure>
            └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ False
           │    │         │    │     │    │                  └ {'item': <Coroutine test_backup_task_failure>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_runtest_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_runtest_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_runtest_call'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ False
           │    │               │          │        └ {'item': <Coroutine test_backup_task_failure>}
           │    │               │          └ [<HookImpl plugin_name='threadexception', plugin=<module '_pytest.threadexception' from '/home/jules/.pyenv/versions/3.12.12/...
           │    │               └ 'pytest_runtest_call'
           │    └ <function _multicall at 0x7fd16d0304a0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd16c704050>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_backup_task_failure>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='runner', plugin=<module '_pytest.runner' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/runner.py", line 179, in pytest_runtest_call
    item.runtest()
    │    └ <function PytestAsyncioFunction.runtest at 0x7fd16bc19440>
    └ <Coroutine test_backup_task_failure>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 469, in runtest
    super().runtest()
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/python.py", line 1720, in runtest
    self.ihook.pytest_pyfunc_call(pyfuncitem=self)
    │    │                                   └ <Coroutine test_backup_task_failure>
    │    └ <property object at 0x7fd16c777b50>
    └ <Coroutine test_backup_task_failure>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_hooks.py", line 512, in __call__
    return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
           │    │         │    │     │    │                  │       └ True
           │    │         │    │     │    │                  └ {'pyfuncitem': <Coroutine test_backup_task_failure>}
           │    │         │    │     │    └ <member '_hookimpls' of 'HookCaller' objects>
           │    │         │    │     └ <HookCaller 'pytest_pyfunc_call'>
           │    │         │    └ <member 'name' of 'HookCaller' objects>
           │    │         └ <HookCaller 'pytest_pyfunc_call'>
           │    └ <member '_hookexec' of 'HookCaller' objects>
           └ <HookCaller 'pytest_pyfunc_call'>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_manager.py", line 120, in _hookexec
    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
           │    │               │          │        │       └ True
           │    │               │          │        └ {'pyfuncitem': <Coroutine test_backup_task_failure>}
           │    │               │          └ [<HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/sit...
           │    │               └ 'pytest_pyfunc_call'
           │    └ <function _multicall at 0x7fd16d0304a0>
           └ <_pytest.config.PytestPluginManager object at 0x7fd16c704050>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pluggy/_callers.py", line 121, in _multicall
    res = hook_impl.function(*args)
          │         │         └ [<Coroutine test_backup_task_failure>]
          │         └ <member 'function' of 'HookImpl' objects>
          └ <HookImpl plugin_name='python', plugin=<module '_pytest.python' from '/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site...
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/_pytest/python.py", line 166, in pytest_pyfunc_call
    result = testfunction(**testargs)
             │              └ {}
             └ <function test_backup_task_failure at 0x7fd168d704a0>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/site-packages/pytest_asyncio/plugin.py", line 716, in inner
    runner.run(coro, context=context)
    │      │   │             └ <_contextvars.Context object at 0x7fd168d67a00>
    │      │   └ <coroutine object test_backup_task_failure at 0x7fd168bad0c0>
    │      └ <function Runner.run at 0x7fd16c393ce0>
    └ <asyncio.runners.Runner object at 0x7fd168b825a0>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-22' coro=<test_backup_task_failure() running at /app/tests/test_backup_task.py:73> cb=[_run_until_co...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x7fd16c3918a0>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x7fd168b825a0>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/base_events.py", line 678, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x7fd16c391800>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/base_events.py", line 645, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x7fd16c393600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/base_events.py", line 1999, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x7fd16c327ba0>
    └ <Handle Task.task_wakeup(<_GatheringFu...=[None, None]>)>
  File "/home/jules/.pyenv/versions/3.12.12/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<_GatheringFu...=[None, None]>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<_GatheringFu...=[None, None]>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<_GatheringFu...=[None, None]>)>

  File "/app/tests/test_backup_task.py", line 73, in test_backup_task_failure
    await process.run()
          │       └ <function BackupTaskProcess.run at 0x7fd1692534c0>
          └ <resource.task.backup_task.BackupTaskProcess object at 0x7fd1688b3710>

> File "/app/resource/task/backup_task.py", line 49, in run
    await self.work(task_logger)
          │    │    └ <loguru.logger handlers=[(id=0, level=10, sink=<_io.FileIO name=8 mode='rb+' closefd=True>), (id=2, level=10, sink='data/logs...
          │    └ <function BackupTaskProcess.work at 0x7fd1692532e0>
          └ <resource.task.backup_task.BackupTaskProcess object at 0x7fd1688b3710>

  File "/app/resource/task/backup_task.py", line 35, in work
    raise e

  File "/app/resource/task/backup_task.py", line 30, in work
    raise Exception(f"数据库备份进程异常退出，状态码: {db_process.returncode}, 原因: {err_info}")
                                        │          │                 └ 'Error dump'
                                        │          └ 1
                                        └ <AsyncMock id='140537378849520'>

Exception: 数据库备份进程异常退出，状态码: 1, 原因: Error dump
2026-02-15 11:49:24.850 | INFO     | resource.task.backup_task:run:56 - --- 任务 2 结束 ---
